CREATE OR REPLACE TABLE `{{ params.project_id }}.cl._rps_order_status` AS
SELECT ARRAY<STRUCT<id INT64, state STRING>>[
        STRUCT(0, 'NEW')
      , STRUCT(1, 'ACCEPTED')
      , STRUCT(2, 'REJECTED')
      , STRUCT(3, 'CLOSED')
      , STRUCT(4, 'EXPIRED')
      , STRUCT(5, 'PREORDER_ACCEPTED')
      , STRUCT(6, 'INITIALIZING')
      , STRUCT(7, 'WAITING_FOR_TRANSPORT')
      , STRUCT(8, 'CANCELLED')
      , STRUCT(9, 'MISSED')
      , STRUCT(10, 'CANCELLED_BY_PLATFORM')
      , STRUCT(11, 'CANCELLED_BY_TRANSPORT')
    ] AS delivery_states
  , ARRAY<STRUCT<id INT64, state STRING>>[
        STRUCT(0, 'UNDEFINED')
      , STRUCT(1, 'PICKUP')
      , STRUCT(2, 'WAITING_FOR_DISPATCH')
      , STRUCT(3, 'DISPATCHED')
      , STRUCT(4, 'SETTLED')
      , STRUCT(5, 'CANCELLED')
    ] AS dispatch_states
  , ARRAY<STRUCT<id INT64, state STRING>>[
        STRUCT(0, 'NOT_TRACKED')
      , STRUCT(1, 'TRACKED')
      , STRUCT(2, 'EN_ROUTE')
      , STRUCT(3, 'DELIVERED')
      , STRUCT(4, 'CANCELLED')
      , STRUCT(5, 'ITEMS_PURCHASED')
    ] AS tracking_states
  , ARRAY<STRUCT<id INT64, reason STRING, owner STRING, is_cancelled_by_vendor BOOL>>[
        STRUCT(1, 'FRAUD_PRANK', 'CUSTOMER', FALSE)
      , STRUCT(2, 'DUPLICATE_ORDER', 'CUSTOMER', FALSE)
      , STRUCT(3, 'OUTSIDE_DELIVERY_AREA', 'VENDOR', TRUE)
      , STRUCT(4, 'NO_COURIER', 'VENDOR', TRUE)
      , STRUCT(5, 'TOO_BUSY', 'VENDOR', TRUE)
      , STRUCT(6, 'ADDRESS_INCOMPLETE_MISSTATED', 'CUSTOMER', FALSE)
      , STRUCT(7, 'CARD_READER_NOT_AVAILABLE', 'VENDOR', TRUE)
      , STRUCT(8, 'MOV_NOT_REACHED', 'VENDOR', TRUE)
      , STRUCT(10, 'REASON_UNKNOWN', 'PLATFORM', FALSE)
      , STRUCT(11, 'UNABLE_TO_FIND', 'CUSTOMER', FALSE)
      , STRUCT(12, 'UNABLE_TO_FIND', 'CUSTOMER', FALSE)
      , STRUCT(13, 'ORDER_MODIFICATION_NOT_POSSIBLE', 'CUSTOMER', FALSE)
      , STRUCT(14, 'EXTRA_CHARGE_NEEDED', 'CUSTOMER', FALSE)
      , STRUCT(15, 'ADDRESS_INCOMPLETE_MISSTATED', 'CUSTOMER', FALSE)
      , STRUCT(20, 'TOO_BUSY', 'VENDOR', TRUE)
      , STRUCT(21, 'ITEM_UNAVAILABLE', 'VENDOR', TRUE)
      , STRUCT(22, 'CLOSED', 'VENDOR', FALSE)
      , STRUCT(23, 'TECHNICAL_PROBLEM', 'PLATFORM', FALSE)
      , STRUCT(24, 'UNABLE_TO_FIND', 'CUSTOMER', FALSE)
      , STRUCT(25, 'BAD_WEATHER', 'VENDOR', TRUE)
      , STRUCT(26, 'MENU_ACCOUNT_SETTINGS', 'VENDOR', TRUE)
      , STRUCT(30, 'REASON_UNKNOWN', 'CUSTOMER', FALSE)
      , STRUCT(31, 'UNREACHABLE', 'VENDOR', TRUE)
      , STRUCT(32, 'REASON_UNKNOWN', 'VENDOR', TRUE)
      , STRUCT(40, 'TECHNICAL_PROBLEM', 'TRANSPORT', FALSE)
      , STRUCT(41, 'TECHNICAL_PROBLEM', 'TRANSPORT', FALSE)
      , STRUCT(42, 'TECHNICAL_PROBLEM', 'TRANSPORT', FALSE)
      , STRUCT(43, 'BAD_LOCATION', 'PLATFORM', FALSE)
      , STRUCT(44, 'OUTSIDE_DELIVERY_AREA', 'TRANSPORT', FALSE)
      , STRUCT(45, 'BILLING_PROBLEM', 'TRANSPORT', FALSE)
      , STRUCT(46, 'COURIER_ACCIDENT', 'TRANSPORT', FALSE)
      , STRUCT(47, 'OUTSIDE_SERVICE_HOURS', 'TRANSPORT', FALSE)
      , STRUCT(48, 'NO_COURIER', 'TRANSPORT', FALSE)
      , STRUCT(49, 'UNABLE_TO_FIND', 'CUSTOMER', FALSE)
      , STRUCT(50, 'BAD_WEATHER', 'TRANSPORT', FALSE)
      , STRUCT(51, 'TECHNICAL_PROBLEM', 'TRANSPORT', FALSE)
      , STRUCT(52, 'CLOSED', 'TRANSPORT', FALSE)
      , STRUCT(53, 'ADDRESS_INCOMPLETE_MISSTATED', 'CUSTOMER', FALSE)
      , STRUCT(54, 'OUTSIDE_DELIVERY_AREA', 'CUSTOMER', FALSE)
    ] AS fail_reasons
  , ARRAY<STRUCT<state STRING, reason STRING, owner STRING, is_cancelled_by_vendor BOOL>>[
        STRUCT('EXPIRED', 'NO_RESPONSE', 'VENDOR', TRUE)
      , STRUCT('MISSED', 'UNREACHABLE', 'VENDOR', TRUE)
      , STRUCT(NULL, 'BLACKLISTED', 'CUSTOMER', FALSE)
      , STRUCT(NULL, 'CONTENT_WRONG_MISLEADING', NULL, FALSE)
      , STRUCT(NULL, 'COURIER_UNREACHABLE', 'TRANSPORT', FALSE)
      , STRUCT(NULL, 'DELIVERY_ETA_TOO_LONG', NULL, FALSE)
      , STRUCT(NULL, 'FOOD_QUALITY_SPILLAGE', 'VENDOR', TRUE)
      , STRUCT(NULL, 'LATE_DELIVERY', NULL, FALSE)
      , STRUCT(NULL, 'MISTAKE_ERROR', 'CUSTOMER', FALSE)
      , STRUCT(NULL, 'NEVER_DELIVERED', NULL, FALSE)
      , STRUCT(NULL, 'NO_PICKER', NULL, FALSE)
      , STRUCT(NULL, 'TECHNICAL_PROBLEM', NULL, FALSE)
      , STRUCT(NULL, 'TEST_ORDER', 'PLATFORM', FALSE)
      , STRUCT(NULL, 'UNABLE_TO_PAY', 'CUSTOMER', FALSE)
      , STRUCT(NULL, 'UNPROFESSIONAL_BEHAVIOUR', NULL, FALSE)
      , STRUCT(NULL, 'VOUCHER_NOT_APPLIED', 'CUSTOMER', FALSE)
      , STRUCT(NULL, 'WILL_NOT_WORK_WITH_PLATFORM', 'VENDOR', TRUE)
      , STRUCT(NULL, 'WRONG_ORDER_ITEMS_DELIVERED ', NULL, FALSE)
    ] AS oma_fail_reasons
  , ARRAY<STRUCT<state STRING, icash_state ARRAY<STRING>>>[
        STRUCT('WAITING_FOR_TRANSPORT', ['DELIVERY_WAITING_FOR_TRANSPORT'])
      , STRUCT('RECEIVED', ['DELIVERY_INITIALIZING'])
      , STRUCT('RECEIVED_BY_VENDOR', ['NOTIFICATION_SENT_TO_POS'])
      , STRUCT('ACCEPTED_BY_VENDOR', ['DELIVERY_ACCEPTED'])
      , STRUCT('NEAR_PICKUP', ['NOTIFICATION_ORIGIN_ARRIVED'])
      , STRUCT('PICKED_UP', ['NOTIFICATION_DISPATCHED'])
      , STRUCT('NEAR_DROPOFF', ['NOTIFICATION_DESTINATION_ARRIVED'])
      , STRUCT('DELIVERED', ['TRACKING_DELIVERED'])
      , STRUCT('DELAYED', ['NOTIFICATION_DELAYED'])
      , STRUCT('CANCELLED', ['DELIVERY_REJECTED',
          'DELIVERY_EXPIRED',
          'DELIVERY_CANCELLED',
          'DELIVERY_MISSED',
          'DELIVERY_CANCELLED_BY_PLATFORM',
          'DELIVERY_CANCELLED_BY_TRANSPORT'
        ])
    ] AS order_flow
  , ARRAY<STRUCT<states ARRAY<STRING>, is_own_delivery BOOL>>[
        STRUCT(['ASSIGNED_TO_TRANSPORT', 'SENDING_TO_VENDOR'], TRUE)
      , STRUCT(['RECEIVED', 'SENDING_TO_VENDOR'], FALSE)
    ] AS order_flow_delivery_new
  , ARRAY<STRUCT<states ARRAY<STRING>, stage STRING>>[
        STRUCT(['RECEIVED', 'WAITING_FOR_TRANSPORT', 'ASSIGNED_TO_TRANSPORT', 'SENDING_TO_VENDOR', 'RECEIVED_BY_VENDOR', 'ACCEPTED_BY_VENDOR', 'WAITING_FOR_VENDOR', 'WAITING_FOR_PICKUP', 'RECONCILIATION_STARTED', 'RECONCILED_WITH_PLATFORM'], 'CONFIRMATION')
      , STRUCT(['NEAR_PICKUP', 'PICKED_UP'], 'PREPARATION')
      , STRUCT(['NEAR_DROPOFF', 'DELIVERED'], 'DELIVERY')
    ] AS order_flow_stages
