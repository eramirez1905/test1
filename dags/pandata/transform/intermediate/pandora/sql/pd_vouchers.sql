SELECT
  `{project_id}`.pandata_intermediate.PD_UUID(id, rdbms_id) AS uuid,
  id,
  rdbms_id,
  `{project_id}`.pandata_intermediate.PD_UUID(customer_id, rdbms_id) AS customer_uuid,
  customer_id,
  `{project_id}`.pandata_intermediate.PD_UUID(user_id, rdbms_id) AS user_uuid,
  user_id,
  SPLIT(payment_types) AS payment_type_ids,
  code,
  customer_code,

  quantity,
  daily_usage_limit,
  customer_quantity,
  counter,

  code_generation_strategy AS code_generation_strategy_type,
  type,
  product_category_voucher_units AS product_category_voucher_unit_type,

  IF(
    type = 'percentage',
    ROUND(SAFE_DIVIDE(SAFE_CAST(value AS INT64), 100), 2),
    value
  ) AS value,
  ratio_foodpanda AS foodpanda_ratio,
  purpose,
  description,
  channel,
  voucher_not_valid_message,

  CAST(is_general_use_voucher AS BOOLEAN) AS is_general_use,
  CAST(is_order_min_value_for_promotional_products AS BOOLEAN) AS is_order_min_value_for_promotional_products,
  IFNULL(new_customers = 1, FALSE) AS is_new_customer,
  IFNULL(is_new_customer_vertical = 1, FALSE) AS is_new_customer_vertical,
  CAST(is_auto_apply_enabled AS BOOLEAN) AS is_auto_apply_enabled,
  IFNULL(unlimited = 1, FALSE) AS is_unlimited,
  CAST(deleted AS BOOLEAN) AS is_deleted,
  type = 'third_party' AS is_type_third_party,
  type = 'cashback_amount' AS is_type_cashback_amount,
  type = 'amount' AS is_type_amount,
  type = 'free_gift' AS is_type_free_gift,
  type = 'delivery_fee' AS is_type_delivery_fee,
  type = 'percentage' AS is_type_percentage,
  type = 'conditional_bogo' AS is_type_conditional_bogo,
  type = 'product_category' AS is_type_product_category,
  type = 'joker_amount' AS is_type_joker_amount,
  type = 'cashback_percentage' AS is_type_cashback_percentage,

  minimum_order_value AS minimum_order_value_local,
  maximum_order_value AS maximum_order_value_local,
  maximum_discount_amount AS maximum_discount_amount_local,

  SPLIT(platforms) AS platforms,
  SPLIT(expedition_type) AS expedition_types,
  SPLIT(vertical_type) AS vertical_types,

  start_date AS start_date_local,
  stop_date AS stop_date_local,
  TIMESTAMP(CONCAT(CAST(start_date AS STRING), ' ', start_hour)) AS start_at_local,
  TIMESTAMP(CONCAT(CAST(stop_date AS STRING), ' ', stop_hour)) AS stop_at_local,
  created_at AS created_at_local,
  updated_at AS updated_at_local,
  dwh_last_modified AS dwh_last_modified_at_utc
FROM `{project_id}.pandata_raw_ml_backend_latest.vouchers`
