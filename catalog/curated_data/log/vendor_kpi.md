# Vendor KPI (Beta) 

## Table structure may change without any prior notice, use at your own risk.

The Vendor KPI table is meant to contains all Vendor level Performance metrics in absolute numbers only (i.e. Metrics in % or ratio will not be included, e.g. % Fail-rate ). The KPIs are aggregated on hourly level for each vendor, and the 'DATE' and `DATETIME` type columns are stored in local timezone. Time-related fields are displayed in seconds. Distance-related fields are displayed in meters.

| Column | Type | Description | Categories |
| :--- | :--- | :--- | :--- |
| created_date_local | `DATE` | The partition column. The date in local timezone when this row of record is generated by its service (e.g. OMA, Vendor Monitor, GoDroid/GoWin etc.). | |
| created_hour_local | `DATETIME` | The hour in local timezone when this row of record is generated by its service. | |
| entity_id | `STRING` | The code of the local operational entity representing the country. This code is made out of two codes : the two-letter code of the venture, and the country iso. | AP_PA, AR_HU, BK_DE, BK_SG, BO_CA, etc |
| display_name | `STRING` | The common name given to the entity. | |
| brand_id | `STRING` | The code of the global brand operating in the country, identical to the two-letter venture code. | AP, AR, BK, BO, CD, CG, DJ, etc |
| region | `STRING` | The region assigned to the country of the vendor. | ap, eu, kr, mena and us |
| country_iso | `STRING` | A two-character alphanumeric code based on the country of the vendor as specified by ISO 3166-1 ALPHA-2. | AE, AR, AT, AU, BA, etc |
| country_name | `STRING` | The name of the country in English. | Taiwan, etc |
| timezone | `STRING` | The name of the timezone where the city of the vendor is located. The timezone enables time conversion, from UTC to local time. | |
| vendor_code | `STRING` | The identifier of the vendor that is sent from the platform (e.g. Foodpanda) to the Logistics systems. It is specific to the vendor within an entity. | |
| [orders](#orders) | `RECORD` | All the orders related Metrics. | |
| [order_timings](#order-timings) | `RECORD` | All the order timings related Metrics. | Germany, Taiwan, Singapore, United Arab Emirates etc. |
| [defective_orders](#defective-orders) | `RECORD` | All the order timings related Metrics. | |
| [client](#client) | `RECORD` | All the Client related Metrics. | |
| [connectivity](#connectivity) | `RECORD` | All the connectivity related Metrics. | |
| [own_deliveries](#own-deliveries) | `ARRAY<RECORD>` | All the Own Deliveries related Metrics. | |

## orders
| Column | Type | Description | How to use it |
| :--- | :--- | :--- | :--- |
| orders_ct | `INTEGER` | Number of total Orders exists in any of the VLOG tech stack. | |
| success_orders_ct | `INTEGER` | Number of total Successful Orders exists in any of the VLOG tech stack. | |
| fail_orders_ct | `INTEGER` | Number of total Fail Orders in any of the VLOG tech stack. | % Fail-rate = fail_orders_ct / orders_ct  |
| fail_orders_vendor_ct | `INTEGER` | Number of Fail Orders owned by Vendor exists in any of the VLOG tech stack. | % Vendor Fail-rate = fail_orders_vendor_ct / orders_ct |
| fail_orders_transport_ct | `INTEGER` | Number of Fail Orders owned by Transport (Riders) exists in any of the VLOG tech stack. | % Transport Fail-rate = fail_orders_transport_ct / orders_ct |
| fail_orders_platform_ct | `INTEGER` | Number of Fail Orders owned by Platform exists in any of the VLOG tech stack. | % Platform Fail-rate = fail_orders_platform_ct / orders_ct |
| fail_orders_customer_ct | `INTEGER` | Number of Fail Orders owned by Customer exists in any of the VLOG tech stack. | % Customer Fail-rate = fail_orders_customer_ct / orders_ct |
| fail_orders_fulfillment_ct | `INTEGER` | Number of Fail Orders owned by Fulfilment (Grocery) exists in any of the VLOG tech stack. | % Platform Fail-rate = fail_orders_fulfillment_ct / orders_ct |
| fail_orders_unreachable_ct | `INTEGER` | Number of Fail Orders with the reason `UNREACHABLE` exists in any of the VLOG tech stack. Please check [here](https://product.deliveryhero.net/global-vendor/documentation/global-fail-reasons-list/) for details. | % Unreachable Fail-rate = fail_orders_unreachable_ct / orders_ct |
| fail_orders_item_unavailable_ct | `INTEGER` | Number of Fail Orders with the reason `ITEM_UNAVAILABLE` exists in any of the VLOG tech stack. Please check [here](https://product.deliveryhero.net/global-vendor/documentation/global-fail-reasons-list/) for details. | % Unreachable Fail-rate = fail_orders_unreachable_ct / orders_ct |
| fail_orders_no_response_ct | `INTEGER` | Number of Fail Orders with the reason `NO_RESPONSE` exists in any of the VLOG tech stack. Please check [here](https://product.deliveryhero.net/global-vendor/documentation/global-fail-reasons-list/) for details. | % Unreachable Fail-rate = fail_orders_no_response_ct / orders_ct |
| fail_orders_closed_ct | `INTEGER` | Number of Fail Orders with the reason `CLOSED` exists in any of the VLOG tech stack. Please check [here](https://product.deliveryhero.net/global-vendor/documentation/global-fail-reasons-list/) for details. | % Unreachable Fail-rate = fail_orders_closed_ct / orders_ct |
| ngt_orders_ct | `INTEGER` | Number of Orders using NGT (Next Generation Transmission) method, i.e. using SOTI MobiControl + SUNMI devices. | % NGT Orders = ngt_orders_ct / orders_ct |
| godroid_orders_ct | `INTEGER` | Number of Orders being served by GoDroid. | % GoDroid Orders = godroid_orders_ct / orders_ct |
| gowin_orders_ct | `INTEGER` | Number of Orders being served by GoWin. | % GoWin Orders = gowin_orders_ct / orders_ct |
| pos_orders_ct | `INTEGER` | Number of Orders being served by POS Middleware. | % POS Orders = pos_orders_ct / orders_ct |
| pos_direct_orders_ct | `INTEGER` | Number of Orders being served by POS Middleware with Direct method. | % POS Direct Orders = pos_direct_orders_ct / orders_ct |
| pos_indirect_orders_ct | `INTEGER` | Number of Orders being served by POS Middleware with Indirect method. | % POS Indirect Orders = pos_indirect_orders_ct / orders_ct |
| platform_client_orders_ct | `INTEGER` | Number of Orders being served by local Platform Client solutions. | % Platform Orders = platform_client_orders_ct / orders_ct |
| od_orders_ct | `INTEGER` | Number of Own Delivery Orders. | % OD Orders = od_orders_ct / orders_ct |
| vd_orders_ct | `INTEGER` | Number of Vendor Delivery Orders. | % VD Orders = vd_orders_ct / orders_ct |
| pu_orders_ct | `INTEGER` | Number of Pickup Delivery Orders. | % PU Orders = pu_orders_ct / orders_ct |
| preorders_ct | `INTEGER` | Number of Preorders. | % Preorders = preorders_ct / orders_ct |
| asap_orders_ct | `INTEGER` | Number of As-Soon-As-Possible Orders. | % ASAP Orders = asap_orders_ct / orders_ct |

## order-timings
| Column | Type | Description | How to use it |
| :--- | :--- | :--- | :--- |
| total_transmission_time | `INTEGER` | Sum of the total Transmission Time. | Avg Transmission Time (seconds) = total_transmission_time / orders_ct |
| total_response_time | `INTEGER` | Sum of the total Response Time. | Avg Response Time (seconds) = total_response_time / orders_ct |

## defective-orders
| Column | Type | Description | How to use it |
| :--- | :--- | :--- | :--- |
| fail_orders_customer_before_sent_to_vendor_ct | `INTEGER` | Number of Fail Orders before the order is transmitted to Vendor and the Cancellation Reason is owned by Customer. | % Customer Fail Orders before sent to Vendor =  fail_orders_customer_before_sent_to_vendor_ct / orders_ct |
| fail_orders_platform_before_sent_to_vendor_ct | `INTEGER` | Number of Fail Orders before the order is transmitted to Vendor and the Cancellation Reason is owned by Platform. | % Platform Fail Orders before sent to Vendor =  fail_orders_platform_before_sent_to_vendor_ct / orders_ct |
| orders_sent_to_vendor_ct | `INTEGER` | Number of Orders being successfully sent to Vendor. | % Orders successfully sent to Vendor =  orders_sent_to_vendor_ct / orders_ct |
| fail_orders_customer_before_received_by_vendor_ct | `INTEGER` | Number of Fail Orders before the order arrives the Vendor device and the Cancellation Reason is owned by Customer. | % Customer Fail Orders before received by Vendor =  fail_orders_customer_before_received_by_vendor_ct / orders_ct |
| fail_orders_platform_before_received_by_vendor_ct | `INTEGER` | Number of Fail Orders before the order arrives the Vendor device and the Cancellation Reason is owned by Platform. | % Platform Fail Orders before received by Vendor =  fail_orders_platform_before_received_by_vendor_ct / orders_ct |
| orders_received_by_vendor_ct | `INTEGER` | Number of Orders being successfully received by the Vendor.  | % Orders successfully received by Vendor =  orders_received_by_vendor_ct / orders_ct |
| fail_orders_customer_before_vendor_response_ct | `INTEGER` | Number of Fail Orders before having any response from Vendor and the Cancellation Reason is owned by Customer. | % Customer Fail Orders before Vendor response =  fail_orders_customer_before_vendor_response_ct / orders_ct |
| fail_orders_platform_before_vendor_response_ct | `INTEGER` | Number of Fail Orders before having any response from Vendor and the Cancellation Reason is owned by Platform. | % Platform Fail Orders before Vendor response =  fail_orders_platform_before_vendor_response_ct / orders_ct |
| orders_accepted_by_vendor_ct | `INTEGER` | Number of Orders accepted by the Vendor. | % Orders accepted by Vendor =  orders_accepted_by_vendor_ct / orders_ct |
| orders_accepted_by_vendor_within_1_min_ct | `INTEGER` | Number of Orders accepted by the Vendor within 1 min. | % Orders accepted by Vendor within 1 min =  orders_accepted_by_vendor_within_1_min_ct / orders_ct |
| orders_accepted_by_vendor_over_1_min_ct | `INTEGER` | Number of Orders accepted by the Vendor over 1 min. | % Orders accepted by Vendor over 1 min =  orders_accepted_by_vendor_over_1_min_ct / orders_ct |
| orders_rejected_by_vendor_ct | `INTEGER` | Number of Fail Orders rejected by Vendor. | % Orders rejected by Vendor =  orders_rejected_by_vendor_ct / orders_ct |
| orders_modified_by_vendor_ct | `INTEGER` | Number of Orders having the context modified by the Vendor, e.g. the items. | % Orders modified by Vendor =  orders_modified_by_vendor_ct / orders_ct |
| od_orders_estimated_time_within_20_mins_ct | `INTEGER` | Number of OD Orders having estimated time less than 20 mins to deliver. | % OD Orders estimated time within 20 mins =  od_orders_estimated_time_within_20_mins_ct / od_orders_ct |
| od_orders_estimated_time_20_to_35_mins_ct | `INTEGER` | Number of OD Orders having a long estimated time (between 20 ~ 35 mins) to deliver. | % OD Orders estimated time between 20 to 35 mins =  od_orders_estimated_time_20_to_35_mins_ct / od_orders_ct |
| od_orders_estimated_time_over_35_mins_ct | `INTEGER` | Number of OD Orders having a long estimated time (> 35 mins) to deliver. | % OD Orders estimated time over 35 mins =  od_orders_estimated_time_over_35_mins_ct / od_orders_ct |
| od_orders_preparation_time_within_8_mins_ct | `INTEGER` | Number of OD Orders having Preparation Time within 8 mins. | % OD Orders preparation time within 8 mins =  od_orders_preparation_time_within_8_mins_ct / od_orders_ct |
| od_orders_preparation_time_8_to_20_mins_ct | `INTEGER` | Number of OD Orders having Long Preparation Time (8-20 mins). | % OD Orders preparation time between 8 - 20 mins =  od_orders_preparation_time_8_to_20_mins_ct / od_orders_ct |
| od_orders_preparation_time_over_20_mins_ct | `INTEGER` | Number of OD Orders having Long Preparation Time (> 20 mins). | % OD Orders preparation time over 20 mins =  od_orders_preparation_time_over_20_mins_ct / od_orders_ct |
| orders_picked_up_late_2min_ct | `INTEGER` | Number of Orders being picked up late, with a buffer of 2 minutes. | % OD Orders picked up late =  orders_picked_up_late_2min_ct / od_orders_ct |
| orders_implicitly_accepted_by_vendor_ct | `INTEGER` | Number of Orders implicitly accepted by Vendor, i.e. no `order_accepted_at` but with `order_picked_at`. | % Orders picked up late =  orders_implicitly_accepted_by_vendor_ct / orders_ct |
| orders_confirmed_by_vendor_above_30_sec_ct | `INTEGER` | Number of Orders being either accepted or rejected by Vendor within 30 seconds after the order is sent to Vendor. | % Orders confirmed by Vendors over 30 secs = orders_confirmed_by_vendor_above_30_sec_ct / orders_ct |
| orders_sent_to_vendor_over_3_sec_ct | `INTEGER` | Number of Orders that take more than 3 sec to be sent to Vendor. | % Orders sent to Vendors over 3 secs = orders_sent_to_vendor_over_3_sec_ct / orders_ct |
| orders_completed_late_ct | `INTEGER` | Number of Orders being completed later than promised delivery time. | % Orders completed late = orders_completed_late_ct / orders_ct |

## client
| Column | Type | Description | How to use it |
| :--- | :--- | :--- | :--- |
| total_promised_delivery_time_client | `INTEGER` | The total delivery time promised by the Vendor (using client). VD orders only. | % Orders completed late = total_promised_delivery_time_client / vd_orders_ct |
| login_started_ct | `INTEGER` | Number of Vendor started to login, GoWin exclusive. | |
| login_succeeded_ct | `INTEGER` | Number of Vendor completed to login, GoWin exclusive. | % Login succeeded = login_succeeded_ct / login_started_ct |
| login_failed_ct | `INTEGER` | Number of Vendor failed to login, GoWin exclusive. | |

## connectivity
| Column | Type | Description | How to use it |
| :--- | :--- | :--- | :--- |
| slots_ct | `INTEGER` | Number of schedule Slots that the Vendor is scheduled to be available to do orders. | |
| unreachables_ct | `INTEGER` | Frequency of the event that Vendor being unreachable because of connectivity issues.| % Unreachables = unreachables_ct / slots_ct |
| unreachables_0_sec_ct | `INTEGER` | Frequency of the event that Vendor having Unreachability that last less than 1 second.| % 0 sec Unreachables = unreachables_0_sec_ct / unreachables_ct |
| unreachables_60_sec_ct | `INTEGER` | Frequency of the event that Vendor having Unreachability that lasts 1-59 seconds. | % 60 sec Unreachables = unreachables_60_sec_ct / unreachables_ct |
| unreachables_120_sec_ct | `INTEGER` | Frequency of the event that Vendor having Unreachability that lasts 60-119 seconds. | % 120 sec Unreachables = unreachables_120_sec_ct / unreachables_ct |
| unreachables_180_sec_ct | `INTEGER` | Frequency of the event that Vendor having Unreachability that lasts 120-179 seconds. | % 180 sec Unreachables = unreachables_180_sec_ct / unreachables_ct |
| unreachables_over_180_sec_ct | `INTEGER` | Frequency of the event that Vendor having Unreachability that last more than 180 seconds. | % 180 sec Unreachables = unreachables_over_180_sec_ct / unreachables_ct |
| unreachables_100_percent_ct | `INTEGER` | Frequency of the Vendor having connectivity issue that 100% cover their duration of Schedule Slots. | % Full Unreachables = unreachables_100_percent_ct / unreachables_ct |
| total_unreachable_duration | `INTEGER` | Total duration in seconds of the Vendor being unreachable. | % Unreachable Durations = total_unreachable_duration / slots_ct |
| total_unreachable_duration_60_sec | `INTEGER` | Duration in seconds of the Vendor being unreachable if the Unreachablility last from 0-59 seconds. | % 60 secs Unreachable Durations = total_unreachable_duration_60_sec / total_unreachable_duration |
| total_unreachable_duration_120_sec | `INTEGER` | Duration in seconds of the Vendor being unreachable if the Unreachablility last from 120 seconds. | % 120 secs Unreachable Durations = total_unreachable_duration_120_sec / total_unreachable_duration |
| total_unreachable_duration_180_sec | `INTEGER` | Duration in seconds of the Vendor being unreachable if the Unreachablility last from 180 seconds. | % 180 secs Unreachable Durations = total_unreachable_duration_180_sec / total_unreachable_duration |
| total_unreachable_duration_over_180_sec | `INTEGER` | Duration in seconds of the Vendor being unreachable if the Unreachablility last more than 180 seconds. | % over 180 secs Unreachable Durations = total_unreachable_duration_over_180_sec / total_unreachable_duration |
| offlines_ct | `INTEGER` | Frequency of the Vendor being taken offline by Vendor Monitor. | % Offlines = offlines_ct / slots_ct |
| offline_1800_sec_ct | `INTEGER` | Frequency of the Vendor being offlined by Vendor connectivity issue that last less than 30 mins. | % 30 mins Offlines = offline_1800_sec_ct / slots_ct |
| offline_over_1800_sec_ct | `INTEGER` | Frequency of the Vendor being offlined by Vendor Monitor that last more than 30 mins. | % Over 30 mins Offlines = offline_over_1800_sec_ct / slots_ct |

## own-deliveries
| Column | Type | Description | How to use it
| :--- | :--- | :--- | :--- |
| country_code | `STRING` | A two-character alphanumeric code based on the code of the country as specified by ISO 3166-1 ALPHA-2. | |
| city_id | `INTEGER` | The numeric identifier assigned to the city. This id is only unique within the same country. | |
| city_name | `STRING` | The name of the city in English. | |
| created_hour_local | `TIME` | The truncated hour part of the created_date_local. All the orders within one hour, their KPIs are aggregated together. | |
| hour_bucket | `STRING` | Split of the day into lunch (11h30 to 15h00), dinner (18h00 to 23h00) and offpeak (remaining operating hours) according to the created_hour_local .  | |
| vendor_name | `STRING` | The name of the vendor. | |
| vertical_type | `STRING` | The vertical type of a vendor. In other words, it describes types of goods that are delivered. This data comes from the delivery area service (DAS). | |
| is_preorder | `BOOLEAN` | Flag whether the order was preordered. | |
| is_corporate | `BOOLEAN` | Flag whether the order was a corporate order. Get info from cl.orders.tags. | |
| successful_orders | `INTEGER` | The number of distinct orders completed for the selected timeline. | |
| cancelled_orders | `INTEGER` | The number of distinct orders cancelled for the selected timeline. | |
| successful_deliveries | `INTEGER` | The number of completed deliveries for the selected timeline, including both primary deliveries and non-primary deliveries.
| total_deliveries | `INTEGER` | The number of all deliveries for the selected timeline, including both primary deliveries and non-primary deliveries.
| stacked_deliveries | `INTEGER` | The number of completed deliveries that shared the bag with at least another delivery. | % Stacked Deliveries = stacked_deliveries / successful_deliveries | |
| stacked_deliveries_intravendor | `INTEGER` | The number of completed deliveries that were in bag together with at least another delivery from the same vendor. | % Stacked Deliveries (Intravendor) = stacked_deliveries_intravendor / successful_deliveries | |
| promised_delivery_time_sum | `FLOAT` | The total promised delivery time in seconds (calculated by the dispatching serviceï¼‰of all the orders within the selected timeline excluding pre-orders. | Avg. Promised DT (min) = promised_delivery_time_sum / promised_delivery_time_count |
| promised_delivery_time_count | `INTEGER` | The total number of orders where the promised delivery time is available.| Avg. Promised DT =  promised_delivery_time_sum / promised_delivery_time_count |
| delivery_time_sum | `FLOAT` | The total delivery time in seconds (from the moment order is created in hurrier until the rider reaches the customer) of the completed orders for the selected timeline excluding pre-orders. | Avg. DT (min) = delivery_time_sum / delivery_time_count |
| delivery_time_count | `INTEGER` | The total number of completed orders where the delivery time is available.| Avg. DT =  delivery_time_sum / delivery_time_count |
| delivery_time_over_40_count | `INTEGER` | The total number of completed orders delivered with a DT > 40 mins.| % DT > 40 =  delivery_time_over_40_count / delivery_time_count |
| delivery_time_over_45_count | `INTEGER` | The total number of completed orders delivered with a DT > 45 mins.| % DT > 45 =  delivery_time_over_45_count / delivery_time_count |
| delivery_time_over_50_count | `INTEGER` | The total number of completed orders delivered with a DT > 50 mins.| % DT > 50 =  delivery_time_over_50_count / delivery_time_count |
| delivery_time_over_60_count | `INTEGER` | The total number of completed orders delivered with a DT > 60 mins.| % DT > 60 =  delivery_time_over_60_count / delivery_time_count | 
| delivery_delay_sum| `FLOAT` | The total delivery delay time in seconds (actual delivery time - promised delivery time) of the completed orders within the selected timeline. | Avg. Delivery Delay (min) = delivery_delay_sum / delivery_delay_count |
| delivery_delay_count | `INTEGER` | The total number of completed orders where the delivery delay time can be calculated.| |
| delivery_delay_over_5_count| `INTEGER` | The total number of completed orders delivered with a delivery delay time > 5 mins.| % Delivery Late > 5 = delivery_delay_over_5_count / delivery_delay_count |
| delivery_delay_over_10_count | `INTEGER` | The total number of completed orders delivered with a delivery delay time > 10 mins.| % Delivery Late > 10 = delivery_delay_over_10_count / delivery_delay_count  |
| delivery_delay_over_15_count| `INTEGER` | The total number of completed orders delivered with a delivery delay time > 15 mins.| % Delivery Late > 15 = delivery_delay_over_15_count / delivery_delay_count  |
| rider_late_sum | `FLOAT` | The total rider late time in seconds (rider near restaurant timestamp - original scheduled pickup at timestamp) of the orders within the selected timeline, including only primary delivery and no auto-transition. | Avg. Rider Late (min) = rider_late_sum / rider_late_count |
| rider_late_count | `INTEGER` | The total number of orders where the rider late time can be calculated.| |
| net_rider_late | `INTEGER` | The total number of orders where the rider late time > 0.| |
| rider_late_over_5_count  | `INTEGER` | The total number of orders where the rider late time > 5 mins.| % Rider Late > 5 = rider_late_over_5_count / rider_late_count  |
| rider_late_over_10_count | `INTEGER` | The total number of orders where the rider late time > 10 mins.| % Rider Late > 10 = rider_late_over_10_count/ rider_late_count  |
| rider_late_over_15_count | `INTEGER` | The total number of orders where the rider late time > 15 mins. | % Rider Late > 15 = rider_late_over_15_count/ rider_late_count  |
| vendor_late_sum | `FLOAT` | The total vendor late time in seconds, including only primary delivery and no auto-transition. It is computed only if rider is no later than 10 minutes | Avg. Vendor Late (min) = (vendor_late_sum / 60) / vendor_late_count |
| vendor_late_count | `INTEGER` | The total number of orders where the vendor late time can be calculated. | |
| net_vendor_late | `INTEGER` | The total number of orders where the vendor late time > 0.| % Net vendor late (% of orders where vendor delay > 0 ) = net_vendor_late / vendor_late_count |
| vendor_late_sum_wo_stacked_deliveries | `FLOAT` | The total vendor late time in seconds without stacked delivery orders, including only primary delivery and no auto-transition. | Avg. Vendor Late (min) excluding stacked deliveries = (vendor_late_sum_wo_stacked_deliveries / 60) / vendor_late_count_wo_stacked_deliveries |
| vendor_late_count_wo_stacked_deliveries | `INTEGER` | The total number of orders without stacked delivery orders where the vendor late time can be calculated. | |
| net_vendor_late_wo_stacked_deliveries | `INTEGER` | The total number of orders without stacked delivery orders where the vendor late time > 0.| % Net vendor late (excluding stacked deliveries) = net_vendor_late_wo_stacked_deliveries / vendor_late_count_wo_stacked_deliveries|
| vendor_late_over_5_count  | `INTEGER` | The total number of orders where the vedor late time > 5 mins.| % Vendor Late > 5 = vendor_late_over_5_count / vendor_late_count  |
| vendor_late_over_10_count | `INTEGER` | The total number of orders where the vedor late time > 10 mins.| % Vendor Late > 10 = vendor_late_over_10_count / vendor_late_count  |
| vendor_late_over_15_count | `INTEGER` | The total number of orders where the vedor late time > 15 mins. | % Vendor Late > 15 = vendor_late_over_15_count / vendor_late_count  |
| vendor_late_over_5_less_than_10 | `INTEGER` | The total number of orders where the vedor late time is over 5 mins but less or equal to 10 mins. | |
| vendor_late_over_10_less_than_15 | `INTEGER` | The total number of orders where the vedor late time is over 10 mins but less or equal to 15 mins. | |
| vendor_on_time_count | `INTEGER` | The total number of orders where the vendor late time <= 5 mins.| |
| vendor_on_time_count_wo_stacked_deliveries | `INTEGER` | The total number of orders without stacked delivery orders where the vendor late time <= 5 mins.| |
| rider_vendor_late_count | `INTEGER` | The total number of orders where both vendor and rider are late more than 5 mins.| % Both Late = rider_vendor_late_count / rider_vendor_count |
| rider_vendor_on_time_count | `INTEGER` | The total number of orders where neither vendor nor rider are late more than 5 mins.| % Both On Time = rider_vendor_on_time_count / rider_vendor_count |
| rider_vendor_count | `INTEGER` | The total number of orders where both the rider late time and vendor late time are calculable. | |
| pickup_distance_sum | `FLOAT` | The Manhatten distance in meters calculated from rider accepted location until rider near pickup location as in https://en.wiktionary.org/wiki/Manhattan_distance | Avg. Pickup Distance (km) = (pickup_distance_sum / 1000) / pickup_distance_count |
| pickup_distance_count | `INTEGER` | The total number of completed orders where the pickup distance can be calculated. | |
| pickup_distance_google_sum | `FLOAT` | The distance in meters calculated from rider accepted location until rider near pickup location based on google routes. | |
| pickup_distance_google_count | `INTEGER` | The total number of completed orders where the google pickup distance can be calculated. | |
| dropoff_distance_sum | `FLOAT` | The Manhatten distance in meters calculated from rider left pickup location until rider near customer location as in https://en.wiktionary.org/wiki/Manhattan_distance | Avg. Dropoff Distance (km) = (dropoff_distance_sum / 1000) / dropoff_distance_count |
| dropoff_distance_count | `INTEGER` | The total number of completed orders where the dropoff distance can be calculated. | |
| dropoff_distance_google_sum | `FLOAT` | The distance in meters calculated from rider left pickup location until rider near customer location based on google routes. | |
| dropoff_distance_google_count | `INTEGER` | The total number of completed orders where the google dropoff distance can be calculated. | |
| delivery_distance_sum | `FLOAT` | The pre-calculated distance in meters from vendor location to customer location when the order is created. | Avg. Delivery Distance (km) = (delivery_distance_sum / 1000) / delivery_distance_count|
| delivery_distance_count | `INTEGER` | The total number of completed orders where the delivery distance can be calculated. | | | 
| bag_time_sum| `FLOAT` | The total time in seconds from when the food was ready until the rider got to the customer for completed orders. | Avg. Bag Time (min) = (bag_time_sum / 60) / bag_time_count |
| bag_time_count | `INTEGER` | The total number of completed orders where the bag time can be calculated.| |
| accepting_time_sum| `FLOAT` | The total rider accepting time (from the first dispatch time to the time the rider accepted the order) in seconds. In case multiple riders accepted the order, the last event is taken. | |
| accepting_time_count | `INTEGER` | The total number of orders where the rider accepting time can be calculated.| |
| dispatching_time_sum | `FLOAT` | The total order dispatching time (from the first dispatch time to the time the rider was notified) in seconds. In case multiple rider were notified, the last event is taken. | |
| dispatching_time_count | `INTEGER` | The total number of orders where the order dispatching time can be calculated.| |
| estimated_prep_time_sum| `INTEGER` | The total estimated time in seconds needed from the vendors to prepare the food. This is computed by data science models | |
| estimated_prep_time_count | `INTEGER` | The total number of orders where the estimated prep time can be calculated.| |
| estimated_prep_buffer_time_sum| `INTEGER` | The total estimated buffer time in seconds added by model on top of estimated prep time. | |
| estimated_prep_buffer_time_count | `INTEGER` | The total number of orders where the estimated buffer time can be calculated.| |
| assumed_actual_preparation_time_sum| `INTEGER` | The total assumed prep time in seconds needed from the vendors. | |
| assumed_actual_preparation_time_count | `INTEGER` | The total number of orders where the assumed prep time can be calculated.| | |
| to_vendor_time_sum | `INTEGER` | The total time in seconds between rider acceptance and arriving at the vendor. | Avg. To vendor time (min) = (to_vendor_time_sum / 60) / to_vendor_time_count |
| to_vendor_time_count | `INTEGER` | The total number of orders where the to_vendor_time is available. | | |
| at_vendor_time_sum | `INTEGER` | The total time in seconds between rider arrival at vendor and the rider picking up the food. | Avg. At vendor time = (at_vendor_time_sum / 60) / at_vendor_time_count |
| at_vendor_time_count | `INTEGER` | The total number of orders where the at_vendor_time is available. | | |
| at_vendor_time_cleaned_sum | `INTEGER` | The total time in seconds the rider stays at the vendor but computed from the time food should have been picked up (expected time food should have been ready). Not computed if rider is late > 10 mins to allow possible re-cooking of the food. | Avg. At vendor time - Cleaned (min) = (at_vendor_time_cleaned_sum / 60) / at_vendor_time_cleaned_count |
| at_vendor_time_cleaned_count | `INTEGER` | The total number of orders where the at_vendor_time_cleaned is available. | | |
| to_customer_time_sum | `INTEGER` | The total time in seconds between rider arrival at customer and the pickup time. | |
| to_customer_time_count | `INTEGER` | The total number of orders where the to_customer_time is available. | |
| at_customer_time_sum | `INTEGER` | The total time in seconds between rider arrival at customer and the customer pickup time. | |
| at_customer_time_count | `INTEGER` | The total number of orders where the at_customer_time is available. | | |
| near_pickup | `INTEGER` | The total number of deliveries where the near pick up GPS tracking are not available (auto-transition is True). | % Near pickup error = near_pickup / total_deliveries |
| cross_border_orders | `INTEGER` | The total number of orders crossing 2 or more zones. | % Cross Border orders = cross_border_orders / (successful_orders + cancelled_orders) |
| reliable_rate_n | `INTEGER` | The total number of orders which is counted as reliable from the vendor side. Reliability is computed as the difference between vendor late and rider late in minutes. If this difference is below 5 minutes then the vendor is considered as reliable. | Reliability Rate = reliable_rate_n / reliable_rate_d |
| reliable_rate_d | `INTEGER` | The total number of orders where the reliability rate can be calculated. | |
| city_market_share | `FLOAT` | The total orders of the vendor over the total orders within it's city (timeframe past 4 weeks). | |
| running_total | `INTEGER` | The running total of orders for the past 4 weeks within vendor's city. | % Vendor running total = running_total / city_total |
| city_total | `INTEGER` | The total of orders for the past 4 weeks within vendor's city. | |
| city_decile | `INTEGER` | The decile position of the vendor in terms of total orders in descending order in its city. | |
| country_centile | `INTEGER` | The centile position of the vendor in terms of total orders in descending order in its country. | |

### Examples (only for KPIs in OWN DELIVERIES scope):
**Important : The vendor_kpi table is partitioned by `created_date_local`. For query efficiency reason, please always consider to put this field in the WHERE clauses.**
<br /> Example 1.  Some KPIs shown on Vendor Report - Vendor ID card for a selected vendor on selected date range.
```sql
WITH aggregation AS (
    SELECT country_name
        , city_name
        , entity_id
        , vendor_code
        , vendor_name
        , FORMAT_DATE("%G-%V", created_date_local) AS delivery_week
        , SUM(od.successful_orders) AS orders_completed
        , SUM(od.successful_deliveries) AS deliveries_completed
        , SUM(od.total_deliveries ) AS total_deliveries
        , SUM(od.cancelled_orders) AS cancelled_orders
        , SUM(od.stacked_deliveries) AS stacked_deliveries
        , SUM(od.stacked_deliveries_intravendor) AS stacked_deliveries_intravendor
        , SUM(od.cancelled_orders) + SUM(od.successful_orders) AS total_orders 
        , SUM(od.delivery_time_sum) / 60 AS delivery_time_min_sum
        , SUM(od.delivery_time_count) AS delivery_time_count
        , SUM(od.pickup_distance_sum) / 1000 AS pickup_distance_manhattan_km_sum
        , SUM(od.pickup_distance_count) AS pickupdistance_count
        , SUM(od.delivery_distance_sum) / 1000 AS delivery_distance_km_sum
        , SUM(od.delivery_distance_count) AS delivery_distance_count
        , SUM(od.vendor_late_over_10_count) AS vendor_late_over_10_count
        , SUM(od.vendor_late_count) AS vendor_late_all_count
        , SUM(od.rider_late_over_10_count) AS rider_late_over_10_count
        , SUM(od.rider_late_count) AS rider_late_all_count
        , SUM(od.estimated_prep_time_sum) / 60 AS est_prep_time_min_sum 
        , SUM(od.estimated_prep_time_count) AS est_prep_time_count
        , SUM(od.near_pickup) AS near_pickup_error_count
        , SUM(od.reliable_rate_n) AS reliability_rate_n
        , SUM(od.reliable_rate_d) AS reliability_rate_d
      FROM `fulfillment-dwh-production.curated_data_shared.vendor_kpi` v
-- Here the CROSS JOIN is used to eliminate the NULL values from VENDOR_DELIVERY / PICKUP deliveries.
      CROSS JOIN UNNEST (own_deliveries) od
      WHERE created_date_local BETWEEN 'yyyy-mm-dd'AND 'yyyy-mm-dd'
        AND country_code = 'aa'
        AND vendor_code = 'bbbb'
      GROUP BY 1, 2, 3, 4, 5, 6
)
SELECT country_name
    , city_name
    , entity_id
    , vendor_code
    , vendor_name
    , delivery_week
    , orders_completed
    , deliveries_completed
    , ROUND(SAFE_DIVIDE(cancelled_orders, total_orders), 3) AS cancelled_orders_pct
    , ROUND(SAFE_DIVIDE(stacked_deliveries, deliveries_completed), 3) AS stacked_deliveries_pct
    , ROUND(SAFE_DIVIDE(stacked_deliveries_intravendor, deliveries_completed), 3) AS stacked_deliveries_intravendor_pct  
    , ROUND(SAFE_DIVIDE(delivery_time_min_sum, delivery_time_count), 1) AS avg_dt_min
    , ROUND(SAFE_DIVIDE(pickup_distance_manhattan_km_sum, pickup_distance_count), 1) AS avg_pickup_distance_manhattan_km
    , ROUND(SAFE_DIVIDE(delivery_distance_km_sum, delivery_distance_count), 1) AS avg_delivery_distance_km
    , ROUND(SAFE_DIVIDE(vendor_late_over_10_count, vendor_late_all_count), 3) AS vendor_late_over_10_pct
    , ROUND(SAFE_DIVIDE(rider_late_over_10_count, rider_late_All_count), 3) AS rider_late_over_10_pct
    , ROUND(SAFE_DIVIDE(est_prep_time_min_sum, est_prep_time_count), 1) AS avg_est_prep_time_min
    , ROUND(SAFE_DIVIDE(near_pickup_error_count, total_deliveries), 3) AS near_pickup_error
    , ROUND(SAFE_DIVIDE(reliability_rate_n, reliability_rate_d), 3) AS reliability_rate
FROM aggregation
```

Example 2.  In the following query we can calculate: <ul><li> The percentage of orders with vendor late >0 (% Net vendor late) with and without stacked deliveries.</li></ul><ul><li> The Avg. Vendor Late (min) with and without stacked deliveries.</li></ul>
```sql
WITH aggregation AS (
  SELECT country_code
    , entity_id
    , FORMAT_DATE("%G-%V", created_date_local) AS delivery_week
    , SUM(od.net_vendor_late) AS net_vendor_late
    , SUM(od.vendor_late_count) AS vendor_late_all_count
    , (SUM(od.vendor_late_sum) / 60) AS vendor_late_min_sum
    , SUM(od.net_vendor_late_wo_stacked_deliveries) AS net_vendor_late_wo_stacked_deliveries
    , SUM(od.vendor_late_count_wo_stacked_deliveries) AS vendor_late_all_count_wo_Stacked_deliveries
    , (SUM(od.vendor_late_sum_wo_stacked_deliveries) / 60) AS vendor_late_min_sum_wo_stacked_deliveries
  FROM `fulfillment-dwh-production.curated_data_shared.vendor_kpi` v
-- Here the CROSS JOIN is used to eliminate the NULL values from VENDOR_DELIVERY / PICKUP deliveries.
  CROSS JOIN UNNEST (own_deliveries) od
  WHERE created_date_local BETWEEN 'yyyy-mm-dd'AND 'yyyy-mm-dd' 
    AND country_code = 'aa'
  GROUP BY 1, 2, 3
)
SELECT country_code
  , entity_id
  , delivery_week
  , ROUND(100*SAFE_DIVIDE(net_vendor_late, vendor_late_all_count), 2) AS vendor_late_ratio
  , ROUND(100*SAFE_DIVIDE(net_vendor_late_wo_stacked_deliveries, vendor_late_all_count_wo_Stacked_deliveries), 2) AS vendor_late_ratio_wo_stacked_deliveries
  , ROUND(SAFE_DIVIDE(vendor_late_min_sum , vendor_late_all_count) , 1) AS avg_vendor_late_min
  , ROUND(SAFE_DIVIDE(vendor_late_min_sum_wo_stacked_deliveries, vendor_late_all_count_wo_Stacked_deliveries) , 1) AS avg_vendor_late_min_wo_stacked_deliveries
FROM aggregation
```
