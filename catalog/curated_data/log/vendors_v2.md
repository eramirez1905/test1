# Vendors V2

| Column | Type | Description |
| :--- | :--- | :--- |
| entity_id | `STRING` | Global Unique Identifier generated by DWH to identify a brand, platform in a specific country. A vendor can serve more than one brand. |
| vendor_code | `STRING` | Code used by customers and customer care to identify the vendor. |
| name | `STRING` |Name shown to the customers or used by Customer Care to recognize the vendor. <br>Maximum length is 300 characters. |
| is_monitor_enabled | `BOOLEAN` | A flag indicating if the vendor is enabled with the service of Vendor Monitor. |
| cuisines | `ARRAY<STRING>`| The cuisine(s) in which the vendor specialised. |
| tags | `STRING` | N/A. |
| delivery_provider | `ARRAY<STRING>`| Whether the food is delivered by a platform (e.g., Foodora), by the vendor itself, or in another way. |
| vertical_type | `STRING` | Describe the vertical type of a vendor. In other words, it describes types of goods that are delivered. This data comes from the delivery area service (DAS). |
| customer_types | `ARRAY<STRING>` | N/A. |
| characteristics | `ARRAY<STRING>` | N/A. |
| vehicle_profile | `STRING` | N/A. |
| is_active | `BOOLEAN` | If the vendor is active or not in Porygon. |
| [is_active_history](#is_active-history) | `RECORD` | history of the vendor active status in Porygon. |
| [chain](#chain) | `RECORD` | N/A. |
| [address](#address) | `RECORD` | N/A. |
| [hurrier](#hurrier) | `RECORD` | Hurrier dataset |
| [rps](#rps) | `RECORD` | RPS dataset |
| preparation_time_prediction_reset_at | `TIMESTAMP` | The date and time when a restaurant wants to reset its preparation time predictions. This flag is used to drop old orders from the preptime model training dataset. By using this date, only orders that came in after the reset date are considered.|
| location | `GEOGRAPHY` | Location of the vendor |
| last_provided_location | `GEOGRAPHY` | N/A. |
| location_history | `ARRAY<GEOGRAPHY>`| The history of the updated vendor locations within the logistics systems. |
| [delivery_areas](#delivery-areas) | `ARRAY<RECORD>`| Array containing current and historical delivery areas of the vendor. |
| [delivery_areas_location](#delivery_areas_location) | `ARRAY<RECORD>`| Array containing the country_code, city_id and city_name of the vendor based on the porygon location data of the vendor.|
| [porygon](#porygon) | `RECORD` | Porygon dataset |
| [polygon_drive_times](#polygon-drive-times) | `ARRAY<RECORD>` | Polygon drive times dataset. | 
| [dps](#dps) | `ARRAY<RECORD>` | Dynamic Pricing vendor configuration dataset. | 
| [time_buckets](#time-buckets) | `ARRAY<RECORD>` | Dataset for preparation time and buffer of a vendor. |
| [prep_time_config](#prep-time-config) | `ARRAY<RECORD>` | Dataset for preparation time configuration set up. |

### Is_Active History

| Column | Type | Description |
| :--- | :--- | :--- |
| is_active | `BOOLEAN` | vendor is active or not in Porygon. |
| updated_at | `TIMESTAMP` | The date and time the is_active status was updated in Porygon in UTC. |

### Chain

| Column | Type | Description |
| :--- | :--- | :--- |
| id | `STRING` | N/A. |
| name | `STRING` | N/A. |

### Address

| Column | Type | Description |
| :--- | :--- | :--- |
| street | `STRING` | N/A. |
| building | `STRING` | N/A. |
| postal_code | `STRING` | The postal code or the ZIP code of the vendor. |
| city_name | `STRING` | The city name of the vendor. |
| location | `GEOGRAPHY` | The coordinate of the vendor. |
| street | `STRING` | N/A. |
| building | `STRING` | N/A. |
| postal_code | `STRING` | N/A. |

### Contracts

| Column | Type | Description |
| :--- | :--- | :--- |
| region | `STRING` | The region assigned to the country of the vendor. |
| country_code | `STRING` | A two-character alphanumeric code based on the country of the vendor as specified by ISO 3166-1 ALPHA-2. |
| id | `INTEGER` | N/A. |
| operator_code | `STRING` | A code combined by <Country Code> + <Vendor Name> + <Postal Code>. |
| name | `STRING` | N/A. |
| delivery_type | `STRING` | The delivery type being used by the vendor. OWN_DELIVERY means that orders of the vendor will be fulfilled by Delivery Hero's own fleet; VENDOR_DELIVERY delivery (a.k.a. "Marketplace") means that orders of the vendor will be fulfilled by the vendor's fleet. |
| value | `INTEGER` | N/A. |
| is_monitor_enabled | `BOOLEAN` | A flag indicating if the vendor is enabled with the service of Vendor Monitor. |
| deleted | `BOOLEAN` | N/A. |
| enabled | `BOOLEAN` | N/A. |

### Delivery Areas

| Column | Type | Description |
| :--- | :--- | :--- |
| id | `STRING`| Identifier of the delivery area of the vendor in Porygon application. |
| country_code | `STRING`| A two-character alphanumeric code based on the code of the country as specified by ISO 3166-1 ALPHA-2 |
| platform | `STRING`| The platform where the delivery area applies (Eg:Foodora). |
| is_deleted | `BOOLEAN`| Flag indicating if the delivery area is currently deleted. |
| [history](#history) | `ARRAY<RECORD>`| History of the delivery areas. |

### History

| Column | Type | Description |
| :--- | :--- | :--- |
| active_from | `TIMESTAMP`| The datetime from when the attributes of the delivery_area start to be active. |
| active_to | `TIMESTAMP`| The datetime from when the attributes of the delivery_area stopped to be active. If the delivery area is still active, the value is `NULL`. |
| operation_type | `STRING`| It specifies the action on the delivery area. It can be `created`, `updated` or `cancelled`. |
| shape | `GEOGRAPHY`| The geometrical shape of the delivery area. |
| transaction_id | `INTEGER`| The identifier created when delivery area was created or updated. |
| end_transaction_id | `INTEGER`| The identifier created when delivery area was updated. |
| [settings](#settings)| `RECORD`| Records pertaining to specifications of the area (Eg: delivery_fee). Note: not all fields exist in every country. |
| name | `STRING`| The name associated to the delivery area if the user who created it choose one. |
| [edited_by](#edited-by) | `RECORD` | Information of user who create/modify the delivery area. |
| drive_time | `INTEGER`| The drive time associated to the delivery area. |

### Settings

| Column | Type | Description |
| :--- | :--- | :--- |
| [delivery fee](#delivery-fee)| `RECORD`| Records pertaining to specifications of the delivery fee. |
| delivery_time | `FLOAT`| The expected delivery time for the delivery area. |
| municipality_tax | `FLOAT`| Value indicating how much is the municipality tax for the delivery area. |
| municipality_tax_type | `STRING`| Type of the municipality tax. |
| tourist_tax | `STRING`| Tourist tax applied to the delivery area. |
| tourist_tax_type | `STRING`| Type of tourist tax. |
| status | `STRING`| The status of the delivery area (Eg: open, busy). |
| minimum_value | `FLOAT`| The minimum order value to place an order for the vendor within the delivery area. |

### Edited By

| Column | Type | Description |
| :--- | :--- | :--- |
| user_id | `STRING`| The user_id associated with the user who created/modified the delivery area. |
| email | `STRING`| The email associated with the user who created/modified the delivery area. |

### Delivery Fee

| Column | Type | Description |
| :--- | :--- | :--- |
| amount | `FLOAT`| The value of the delivery fee. |
| percentage | `FLOAT`| The percentage of the delivery fee. |

### Hurrier

| Column | Type | Description |
| :--- | :--- | :--- |
| country_code | `STRING` | A two-character alphanumeric code based on the code of the country as specified by ISO 3166-1 ALPHA-2 |
| id | `INTEGER`| The numeric identifier assigned to every vendor. This id is generated within the central logistics systems and is only unique within the same country. |
| [city](#city) | `RECORD` | The city of the vendor within a country. |
| order_value_limit | `FLOAT` | N/A. |
| created_at | `TIMESTAMP` | The date and time the vendor was created in Hurrier in UTC. |
| updated_at | `TIMESTAMP` | The date and time the vendor was updated in Hurrier in UTC. |
| last_provided_location | `GEOGRAPHY` | The last location of the vendor that the platform sent. |
| stacking_mode | `STRING` |It defines which stacking rule is applied at vendor level. |
| custom_stacking_value | `STRING` | In case `custom_stacking` rule is implemented, value will provide further specification to match the rule. |
| max_stacked_orders | `INTEGER` | The max number of stacked orders possible for the vendor. |

### City

| Column | Type | Description |
| :--- | :--- | :--- |
| id | `INTEGER`| Id used by logistics to identify the city of the vendor within a country. |
| name | `STRING`| Name of the city in English. |


### Delivery Areas Location
| Column | Type | Description |
| :--- | :--- | :--- |
| country_code | `STRING`| A two-character alphanumeric code based on the code of the country as specified by ISO 3166-1 ALPHA-2, based on the porygon location data. |
| city_id | `INTEGER`| Id used by logistics to identify the city of the vendor within a country based on the porygon location data. |
| city_name | `STRING`| Name of the city in English, based on the porygon location data. |

### Porygon

| Column | Type | Description |
| :--- | :--- | :--- |
| country_code | `STRING` | A two-character alphanumeric code based on the code of the country as specified by ISO 3166-1 ALPHA-2 |
| platform | `STRING` | N/A. |
| global_entity_id | `STRING` | Global Unique Identifier generated by DWH to identify a brand, platform in a specific country. A vendor can serve more than one brand. |
| name | `STRING`| Name shown to the customers or used by Customer Care to recognize the vendor. <br>Maximum length is 300 characters |
| location | `GEOGRAPHY`| Location of the vendor. |
| created_at | `TIMESTAMP`| The date and time the vendor was created in Hurrier in UTC. |
| updated_at | `TIMESTAMP`| The date and time the vendor was updated in Hurrier in UTC. |
| is_active | `BOOLEAN` | N/A. |
| delivery_provider | `ARRAY<STRING>`| Whether the food is delivered by a platform (e.g., Foodora), by the vendor itself, or in another way. |
| vehicle_profile | `STRING` | N/A. |
| cuisines | `ARRAY<STRING>`| The cuisine(s) in which the vendor specialised. |
| is_halal | `BOOLEAN`| Whether the food prepared by the vendor is halal or not. |
| tags | `STRING` | N/A. |
| vertical_type | `STRING`| Describe the vertical type of a vendor. In other words, it describes types of goods that are delivered. |
| customer_types | `STRING` | N/A. |
| characteristics | `STRING` | N/A. |
| [polygon_drive_times](#polygon-drive-times) | `ARRAY<RECORD>` | Contains available polygon drive times of a vendor. | 

### Polygon Drive Times

| Column | Type | Description |
| :--- | :--- | :--- |
| vehicle_profile | `STRING` | The profile used to estimate the driving times to the vendor and the customer. |
| drive_time | `INTEGER` | Estimation in time that a rider takes to cover any point within the shape. The time is represented in minutes |
| shape | `GEOGRAPHY`| The geometric reference to the polygon of the delivery area. |
| created_at | `TIMESTAMP`| When the record has been created in UTC. |
| updated_at | `TIMESTAMP`| When the record has been updated in UTC. |

### DPS

| Column | Type | Description |
| :--- | :--- | :--- |
| is_active | `BOOLEAN` | A two-character alphanumeric code based on the code of the country. | 
| is_key_account | `BOOLEAN` | Boolean for indicating if the vendor is a key account for the platform. |
| currency | `STRING` | Monetary unit a vendor accepts. |
| variant | `STRING` | Variant of a price configuration for a/b/n testing. |
| scheme_id | `NUMERIC` | Identifier of the scheme. |
| scheme_name | `STRING` | Name of the scheme. | 
| is_scheme_fallback | `BOOLEAN` | Boolean indicating if the scheme is a fallback or was specifically assigned to vendor. |
| [vendor_config](#vendor-config) | `ARRAY<RECORD>` | Contains DPS vendor config data. |

### Vendor Config

| Column | Type | Description |
| :--- | :--- | :--- |
| id | `NUMERIC` | Identifier of the vendor price config. | 
| vendor_config_created_at | `TIMESTAMP`| When the record has been created in UTC. |
| vendor_config_updated_at | `TIMESTAMP`| When the record has been updated in UTC. |
| [pricing_config](#pricing-config) | `ARRAY<RECORD>` | Contains DPS Pricing config data. |

### Pricing Config

| Column | Type | Description |
| :--- | :--- | :--- |
| [travel_time_config](#travel-time-config) | `RECORD` | Configuration of delivery fees that are based on travel time. |
| [mov_config](#mov_config) | `RECORD` | Configuration of minimum order values that are based on travel time. |
| [delay_config](#delay_config) | `RECORD` | Configuration of delivery fees that are based on fleet delay. |

### Travel Time Config

| Column | Type | Description |
| :--- | :--- | :--- |
| id | `STRING` | Identifier of a travel time fee configuration. |
| name | `STRING` | Name of the travel time configuration; used for identification. |
| is_fallback | `BOOLEAN` | Boolean for indicating if the  travel time configuration is a fallback or was specifically assigned to vendor. |
| threshold | `NUMERIC` | Upper limit of travel time for which a delivery fee value applies. |
| fee | `NUMERIC` | Delivery fee value that applies at respective travel time. |
| created_at | `TIMESTAMP` | Creation date and time of travel time configuration. |
| updated_at | `TIMESTAMP` | Update date and time of travel time configuration. |

## MOV Config

| Column | Type | Description |
| :--- | :--- | :--- |
| id | `STRING`| Identifier of a minimum order value configuration. |
| name | `STRING` | Name of the minimum order value configuration; used for identification. |
| is_fallback | `BOOLEAN` | Boolean for indicating if the minimum order value configuration is a fallback or was specifically assigned to vendor. |
| travel_time_threshold |  `NUMERIC` | Upper limit of travel time for which a minimum order value applies. |
| minimum_order_value |  `NUMERIC` | Minimum order value that applies at respective travel time. |
| created_at | `TIMESTAMP` | Creation date and time of minimum order value configuration. |
| updated_at | `TIMESTAMP` | Update date and time of minimum order value configuration. |

## Delay Config

| Column | Type | Description |
| :--- | :--- | :--- |
| id | `STRING`| Identifier of a fleet delay configuration. |
| name | `STRING` | Name of the fleet delay fee configuration; used for identification. |
| is_fallback | `BOOLEAN` | Boolean for indicating if the delay configuration is a fallback or was specifically assigned to vendor. |
| delay_threshold | `NUMERIC` | Upper limit of delay for which a delay applies. |
| travel_time_threshold |  `NUMERIC` | Upper limit of travel time for which a delay applies. |
| fee |  `NUMERIC` | Delivery fee discount/surcharge that applies at respective travel time. |
| created_at | `TIMESTAMP` | Creation date and time of fleet delay fee configuration. |
| updated_at | `TIMESTAMP` | Update date and time of fleet delay fee configuration. |


### RPS

| Column | Type | Description |
| :--- | :--- | :--- |
| region | `STRING` | The region assigned to the country of the vendor. |
| country_iso | `STRING` | A two-character alphanumeric code based on the country of the vendor as specified by ISO 3166-1 ALPHA-2. |
| is_active | `BOOLEAN` | A flag whether the vendor is active in the respective platform. |
| is_latest | `BOOLEAN` | A flag whether the row of record is reflecting the latest status of the vendor in the RPS system. |
| operator_code | `STRING` | A code combined by <Country Code> + <Vendor Name> + <Postal Code>. |
| vendor_id | `INTEGER` | The identifier of a physical vendor within RPS. Only unique within the same `region`. To get a unique id of a record, concatenation of `region` and `vendor_id` is suggested. |
| name | `STRING` | The name of the vendor within RPS. |
| contract_plan | `STRING` | The `Contract Plan` being assigned to the vendor in iCash. `Contract Plan` is a collection of a series of `contract_plan_options`, which can be used to indicate the activation state for particular features (e.g. which client to use, enabled with Vendor Monitor or not, etc.). |
| timezone | `STRING` | The name of the timezone where the city of the vendor is located. The timezone enables time conversion, from UTC to local time. |
| updated_at | `TIMESTAMP` | The latest updating time for this row of record. |
| [client](#client) | `RECORD` | The RPS client related information. |
| [pos](#pos) | `RECORD` | The RPS POS Middleware related information. |
| [contracts](#contracts) | `RECORD` | All contract related information regarding the vendor. |
| delivery_type | `STRING` | The delivery type being used by the vendor. OWN_DELIVERY means that orders of the vendor will be fulfilled by Delivery Hero's own fleet; VENDOR_DELIVERY delivery (a.k.a. "Marketplace") means that orders of the vendor will be fulfilled by the vendor's fleet. |
| is_monitor_enabled | `BOOLEAN` | A flag indicating if the vendor is enabled with the service of Vendor Monitor. |
| delivery_platform | `STRING` | N/A. |
| rps_global_key | `STRING` | N/A. |
| [address](#address) | `RECORD` | All address related information regarding the vendor. |
| service | `STRING` | The name of the application generating this row of record. Can be `Vendor Service` or `iCash`. |

#### client

| Column | Type | Description |
| :--- | :--- | :--- |
| name | `STRING` | The RPS client being used by the vendor. |
| pos_integration_flow | `STRING` | The RPS client being used by the vendor. Could be `DIRECT` or `INDIRECT`. |

#### pos

| Column | Type | Description |
| :--- | :--- | :--- |
| integration_code | `STRING` | The code of the integration in POS Middleware. |
| integration_name | `STRING` | The name of the integration in POS Middleware. |
| is_pos_integration_active | `BOOLEAN` | A flag indicting if the integration is active or not in POS Middleware |
| chain_name | `STRING` | The name of the chain in POS Middleware. |
| chain_code | `STRING` | The code of the chain in POS Middleware. |

### Examples

#### Hurrier vendors
```sql
SELECT entity_id, vendor_code
  , h.*
FROM `fulfillment-dwh-production.curated_data_shared.vendors_v2`
CROSS JOIN UNNEST(hurrier) h
```

#### RPS vendors
```sql
SELECT entity_id, vendor_code
  , r.*
FROM `fulfillment-dwh-production.curated_data_shared.vendors_v2`
CROSS JOIN UNNEST(rps) r
```
#### is_monitor_enabled_history
| Column | Type | Description |
| :--- | :--- | :--- |
| is_monitor_enabled | `BOOLEAN` | A historical record of the flag indicating if the vendor is enabled with the service of Vendor Monitor. |
| updated_at | `TIMESTAMO` | UTC timestamp of the time when the flag `is_monitor_enabled` is updated. |
| is_monitor_enabled | `BOOLEAN` | A flag indicating if the flag `is_monitor_enabled` state  is the latest one or not. |

### Time Buckets
| Column | Type | Description |
| :--- | :--- | :--- |
| active_from | `TIMESTAMP` | The datetime from when the attributes of the tes time bucket start to be active. |
| active_to | `TIMESTAMP` | The datetime from when the attributes of the tes time bucket stopped to be active. |
| id | `STRING` | NA. |
| day_of_week | `STRING` | Day of week on which the order is planned. |
| time_of_day | `STRING` | Time of day on which the order is planned. |
| state | `STRING` | Status |
| preparation_time | `INTEGER` | The time interval in seconds between from sent_to_vendor time to pickup time. |
| preparation_buffer | `TIMESTAMP` | The buffer time interval in seconds. |
| created_by | `STRING` | Identifier of user who created the preparation time of an order. |
| updated_by | `STRING` | Identifier of user who made an update on the preparation time of an order. |

### Prep Time Config
| Column | Type | Description |
| :--- | :--- | :--- |
| strategy | `STRING` | The name of of the state in which the restaurant stays. It can currently be: <br> `COMPUTED`: Preparation times have been calculated by our model (Automatic and updated every week), <br> `OPS_TEMPORARY`:  Values have been manually changed and we've started our observations again. The inserted values will stay until we have again enough data points , <br> `OPS_PERMANENT`: Values have been manually changed and the inserted values will be fixed. |
| updated_at | `TIMESTAMP` | The timestamp when the `strategy` was updated. 
